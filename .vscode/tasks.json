{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Docker: Up Postgres",
      "type": "shell",
      "command": "docker compose -f ${workspaceFolder}/docker-compose.yml up -d",
      "problemMatcher": [],
      "detail": "Levanta Postgres en Docker (donationsdb)"
    },
    {
      "label": "Docker: Down Postgres (con volúmenes)",
      "type": "shell",
      "command": "docker compose -f ${workspaceFolder}/docker-compose.yml down -v",
      "problemMatcher": [],
      "detail": "Detiene y elimina contenedores y datos"
    },
    {
      "label": "Backend: Build",
      "type": "shell",
      "command": "mvn clean package -DskipTests",
      "options": { "cwd": "${workspaceFolder}/backend-springboot" },
      "problemMatcher": [],
      "detail": "Compila el backend (Spring Boot)"
    },
    {
      "label": "Backend: Run",
      "type": "shell",
      "command": "mvn spring-boot:run",
      "options": { "cwd": "${workspaceFolder}/backend-springboot" },
      "isBackground": true,
      "problemMatcher": [
        {
          "owner": "custom",
          "pattern": [{ "regexp": "." }],
          "background": {
            "activeOnStart": true,
            "beginsPattern": ".",
            "endsPattern": "Tomcat started on port 8080"
          }
        }
      ],
      "detail": "Arranca Spring Boot en :8080"
    },
    {
      "label": "Frontend: Clean & Install",
      "type": "shell",
      "command": "rmdir /s /q node_modules && del package-lock.json && npm install",
      "options": { "cwd": "${workspaceFolder}/frontend-angular" },
      "problemMatcher": [],
      "detail": "Limpia node_modules y reinstala (Node 18 via nvm)"
    },
    {
      "label": "Frontend: Install",
      "type": "shell",
      "command": "npm install",
      "options": { "cwd": "${workspaceFolder}/frontend-angular" },
      "problemMatcher": [],
      "detail": "Instala dependencias del frontend con Node 18 (nvm)"
    },
    {
      "label": "Frontend: Serve",
      "type": "shell",
      "command": "npm run start -- --port 4200",
      "options": { "cwd": "${workspaceFolder}/frontend-angular" },
      "isBackground": true,
      "problemMatcher": [
        {
          "owner": "custom",
          "pattern": [{ "regexp": "." }],
          "background": {
            "activeOnStart": true,
            "beginsPattern": ".",
            "endsPattern": "Application bundle generation complete"
          }
        }
      ],
      "detail": "Dev server Angular en :4200 (Node 18 con nvm, usando npm run start)"
    },
    {
      "label": "Run All (DB + Backend + Frontend)",
      "dependsOn": [
        "Docker: Up Postgres",
        "Backend: Run",
        "Frontend: Serve"
      ],
      "dependsOrder": "parallel",
      "detail": "Levanta todo para el día a día"
    },
    {
      "label": "Run First Time (Install + All)",
      "dependsOn": [
        "Docker: Up Postgres",
        "Frontend: Clean & Install",
        "Backend: Build",
        "Backend: Run",
        "Frontend: Serve"
      ],
      "dependsOrder": "parallel",
      "detail": "Para la primera vez en la máquina"
    }
  ]
}
